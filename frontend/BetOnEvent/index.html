<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Footbet </title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

    <header class="header">
        <div class="logo">
            <img src="logo.png" alt="logo" width="140" height="140">
        </div>
        <nav class="nav">
            <a href="../main/menu.html" class="event-button">Home</a>
            <a href="#eventos" class="event-button">Eventos</a>
            <a href="../main/menu.html#sobre" class="event-button">Sobre</a>
            <a href="../main/menu.html#contato" class="event-button">Contato</a>
        </nav>

        <button class="menu-toggle">
            <img src="User1.png" alt="Abrir Menu" class="menu-icon">
        </button>

        <div class="sidebar">
            <div class="sidebar-header">
                <img src="logo.png" alt="logo" width="130" height="130">
                <button class="close-sidebar">&times;</button>
            </div>
            <ul>
                <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="../carteira/usersProfile.html"><i class="fas fa-user"></i> Perfil</a></li>
                <li><a href="#"><i class="fas fa-wallet"></i> Carteira</a></li>
                <li><a href="#"><i class="fas fa-calendar-alt"></i> Minhas Apostas</a></li>
                <li><a href="#"><i class="fas fa-sign-out-alt"></i> Sair</a></li>
            </ul>
        </div>
    </header>

    <section class="hero">
        <div class="hero-content">
            <h2 class="team-name" id="titulo"> </h2>
            <h4 id="descricao"> </h4>
            <h4 id="dtEvento">Data do evento: </h4>
            <h4 id="inicio">Inicio das Apostas: </h4>
            <h4 id="fim">Fim das Apostas: </h4>
            <br>
            <div class="hero-buttons container">
                <button id="openModal" class="button primary" type="button" data-bs-toggle="modal"
                    data-bs-target="#Modal" onclick="passData()">Apostar</button>
            </div>
        </div>
        <div class="hero-image">
            <img src="jogador.png" alt="Jogador de futebol" />
        </div>
    </section>
    <!-- Modal-->
    <div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Finalizar Aposta</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3 m-0">
                            <p>Escolha uma das opções abaixo:</p>
                            <select class="custom-select form-control" id="aposta">
                                <option selected>Escolher</option>
                                <option value="s">Sim</option>
                                <option value="n">Não</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <p>Valor de cada Cota: <strong id="valorCota">R$ 00.00</strong></p>
                        </div>
                        <div class="mb-3">
                            <input type="number" id="qtd_cotas" name="qtd_cotas" class="form-control"
                                placeholder="Quantidade de cotas" required>
                        </div>
                        <input value="carregando" id="idEventoModal" type="hidden"></input>
                        <input value="carregando" id="cota" type="hidden"></input>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="makeBet()">Apostar</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <div class="logo-section">
                <div class="logo">
                    <img src="logo2.png" alt="Logo FootBet" class="logo-image">
                </div>
            </div>

            <div class="text-section">
                <h2>Segurança</h2>
                <p>Para sua segurança, só é permitido fazer apostas maiores de 18 anos.</p>
                <p>Transmitimos credibilidade e segurança nos nossos serviços. Nossa plataforma é segura, legal e fácil
                    de usar.</p>
                <p><strong>Atenção: </strong>não nos responsabilizamos por eventuais perdas, portanto jogue com
                    responsabilidade!</p>
            </div>
        </div>
    </footer>
    </section>
    <script>

        const menuToggle = document.querySelector('.menu-toggle');
        const sidebar = document.querySelector('.sidebar');
        const closeSidebar = document.querySelector('.close-sidebar');

        // Mostrar o menu
        menuToggle.addEventListener('click', () => {
            sidebar.classList.add('active');
        });

        // Fechar o menu
        closeSidebar.addEventListener('click', () => {
            sidebar.classList.remove('active');
        });

        // Fechar o menu clicando fora
        window.addEventListener('click', (event) => {
            if (!sidebar.contains(event.target) && !menuToggle.contains(event.target)) {
                sidebar.classList.remove('active');
            }
        });

        // carregar dados evento na apgina
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year}`;
        }

        function formatDatetime(dateString) {
            const date = new Date(dateString);
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }
        function obterId() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get("id"); // Captura o parâmetro 'id'
            return id;
        }
        var id = obterId();
        console.log(id);
        var valor_cota = null;
        async function carregar(id) {
            if (id) {
                const myHeader = new Headers();
                myHeader.append("Content-Type", "application/json");
                myHeader.append("id_evento", id);

                const requestOptions = {
                    method: "POST",
                    headers: myHeader,
                };

                try {
                    // Esperando a resposta da requisição
                    const result = await fetch("http://localhost:3000/getEventbyID", requestOptions);

                    if (result.ok) {
                        const infos_event = await result.json();  // Converter a resposta para JSON

                        let id_aposta = infos_event[0].id_evento;
                        localStorage.setItem('id_aposta', id_aposta);
                        console.log('id do item', id_aposta)

                        // Verificar o conteúdo da resposta
                        console.log("Resposta do backend:", infos_event);//retornando results normal
                        document.getElementById('titulo').innerHTML = `${infos_event[0].titulo}`;
                        document.getElementById('descricao').innerHTML = `${infos_event[0].descricao}`;
                        document.getElementById('dtEvento').innerHTML = `Data do evento: ${formatDate(infos_event[0].dataEvento)}`;
                        document.getElementById('inicio').innerHTML = `Inicio das Apostas: ${formatDatetime(infos_event[0].inicioApostas)}`;
                        document.getElementById('fim').innerHTML = `Fim das Apostas: ${formatDatetime(infos_event[0].fimApostas)}`;
                        valor_cota = infos_event[0].valor_cota;
                    } else {
                        console.log("Campo 'saldo' não encontrado na resposta.");
                    }
                } catch (error) {
                    console.error("Erro na requisição:", error);
                }
            } else {
                console.log("Erro: ID de usuário não fornecido.");

            }
        }
        let infos_user = JSON.parse(localStorage.getItem('dados_user'));
        let id_user = infos_user.user_id;  // ID do usuário
        console.log(id_user);// ID do usuário
        carregar(id);
        function passData() {
            const idEvento = obterId();
            const inputIdEvento = document.getElementById("idEventoModal");
            if (idEvento) {
                inputIdEvento.value = idEvento; // Atribui o ID ao input
            } else {
                inputIdEvento.value = "ID não encontrado"; // Caso não encontre o ID
            }
            document.getElementById("valorCota").textContent = `R$ ${valor_cota}`;
            document.getElementById("cota").value = `${valor_cota}`;
        }

        async function makeBet() {
            let infos_user = JSON.parse(localStorage.getItem('dados_user'));
            let email = infos_user.email;  // ID do usuário
            // ID do usuário
            const id_evento = document.getElementById("idEventoModal").value;
            const qtd_cotas = document.getElementById("qtd_cotas").value;
            const valor_cota = document.getElementById("cota").value;
            const aposta = document.getElementById("aposta").value;
            console.log(email, aposta);
            if (email) {
                const myHeader = new Headers();
                myHeader.append("Content-Type", "application/json");
                myHeader.append("email", email);
                myHeader.append("id_evento", id_evento);
                myHeader.append("qtd_cotas", qtd_cotas);
                myHeader.append("valor_cota", valor_cota);
                myHeader.append("aposta", aposta);

                const requestOptions = {
                    method: "POST",
                    headers: myHeader,
                };

                try {
                    // Esperando a resposta da requisição
                    const result = await fetch("http://localhost:3000/betOnEvent", requestOptions);

                    if (result.ok) {
                        alert("Aposta realizada com sucesso!");  // Converter a resposta para JSON

                    } else {
                        alert("Erro ao realizar aposta!");
                        console.log(result.text());
                    }
                } catch (error) {
                    console.error("Erro na requisição:", error);
                }
            } else {
                console.log("Erro: email não fornecido.");

            }
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>